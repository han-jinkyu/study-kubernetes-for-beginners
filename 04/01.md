# 1. 쿠버네티스 클러스터의 전체 구조

- 쿠버네티스 클러스터는 크게 두 종류의 서버로 구성한다.
    - 클러스터를 관리하는 **마스터**
    - 실제 컨테이너를 실행하는 **노드**
- 마스터에는 다음과 같은 컴포넌트가 실행된다.
    - `etcd`
    - `kube-apiserver`
    - `kube-scheduler`
    - `kube-controller-manager`
    - `kubelet`
    - `kube-proxy`
    - `docker` 등
- 각 컴포넌트가 다른 마스터나 노드 서버에서 별개로 실행되어도 실제 쿠버네티스 클러스터를 운영하는 데 이상은 없다.
- 하지만 마스터가 서버 1대라면 프로세스 한 묶음을 해당 서버에서 같이 실행하는 것이 일반적이다.
- 마스터는 보통 고가용성을 만족하고자 서버 3대 정도로 구성하여 운영한다.
- 보통 실제 클러스터를 관리하는 리더 마스터는 1대고, 나머지 2대는 대기한다.
- 리더 마스터에 장애가 발생하면 자연스럽게 나머지 2대 중 1대가 리더 역할을 맡는다.
- 클러스터를 좀 더 안정적으로 운영하려면 마스터를 서버 5대로 구성할 수도 있다.
- 노드에는 다음과 같은 컴포넌트가 실행된다.
    - `kubelet`
    - `kube-proxy`
    - `docker` 등
- 실제 사용하는 컨테이너 대부분은 노드에서 실행된다.
- 노드는 쿠버네티스 초기에 미니언이라 불리어서 아직 곳곳에 이를 사용하는 부분이 남아 있다.
- 마스터와 노드의 통신에서 각 컴포넌트의 중심엔 `kube-apiserver`가 있다.
- `kube-apiserver`를 거처 다른 컴포넌트가 서로 필요한 정보를 주고 받는다.
    - 특히 `etcd`에는 `kube-apiserver`만 접근할 수 있다.
- 마스터를 보면 `kubelet`이 마스터에 있는 도커를 관리한다.
- 도커 안에는 `kube-scheduler`, `kube-controller-manager`, `kube-apiserver`, `kube-proxy`가 있다.
- 관리용 컴포넌트는 초창기 직접 서버 프로세스로 실행했지만 이젠 컨테이너다.
    - 관리용 컴포넌트는 모두 하이버큐브라는 바이너리 파일로 컴파일되었고
    - 실행할 때 옵션을 설정해 각 컴포넌트의 역할을 수행한다.
- `etcd`는 컨테이너가 아닌 별도 프로세스로 설정되어 있다.
- 노드 역시 `kubelet`으로 도커를 관리한다.
- `kubelet`은 마스터의 `kube-apiserver`와 통신하면서 파드의 생성, 관리, 삭제를 담당한다.
- 노드의 `kube-proxy`는 마스터와는 다르게 컨테이너가 아닌 서버 프로세스로 실행할 수 있다.
    - 물론 마스터처럼 컨테이너로도 실행할 수 있다.

-----
[HOME](./index.md)
