# 4. kubelet으로 컨테이너 진단하기

- 컨테이너가 실행된 후에는 `kubelet`이 컨테이너를 주기적으로 진단한다.
- 이때 필요한 프로브(Probe)에는 다음 두 가지가 있다.
    - `livenessProbe`: 컨테이너가 실행됐는지 확인한다.
        - 진단이 실패하면 `kubelet`은 컨테이너를 종료하고
        - 재시작 정책에 따라 컨테이너를 재시작한다.
        - 컨테이너에 `livenessProbe`를 어떻게 할지 명시하지 않았다면
        - 기본 상태 값은 `Success`다.
    - `readinessProbe`: 실제로 서비스 요청에 응답할 수 있는지 진단한다.
        - 진단이 실패하면 엔드포인트 컨트롤러는 해당 파드에 연결된 모든 서비스를 대상으로 엔드포인트 정보를 제거한다.
        - 첫 번째 `readinessProbe`를 하기 전 기본 상태 값은 `Failure`다.
        - `readinessProbe`를 지원하지 않는 컨테이너라면 기본 상태 값은 `Success`다.
- 두 가지 프로브가 있는 것이 쿠버네티스의 장점이다.
- `readinessProbe`를 지원하는 컨테이너라면 컨테이너 실행 직후 바로 서비스에 투입되어 트래픽을 받지는 않는다.
    - 실제 트래픽을 받을 **준비**가 되었는지 확인하고 트래픽을 받는다.
    - 이는 자바 애플리케이션처럼 프로세스가 시작된 후 앱이 초기화될 때 시간이 걸리는 상황에 유용하다.
- 컨테이너 진단은 컨테이너가 구현한 핸들러를 `kubelet`이 호출해서 실행한다.
- 핸들러에는 다음 세 가지가 존재한다.
    - `ExecAction`: 컨테이너 안에 지정된 명령을 실행하고 종료 코드가 0일 때 `Success`라고 진단한다.
    - `TCPSocketAction`: 컨테이너 안에 지정된 IP와 포트로 TCP 상태를 확인하고 포트가 열려있다면 `Success`라고 진단한다.
    - `HTTPGetAction`: 컨테이너 안에 지정된 IP, 포트, 경로로 HTTP GET 요청을 보내어 응답코드가 200 ~ 400 사이면 `Success`라고 진단한다.
- 진단 결과도 세 가지가 존재한다.
    - `Success`: 컨테이너가 진단에 성공
    - `Failure`: 컨테이너가 진단에 실패
    - `Unknown`: 진단 자체가 실패해서 컨테이너 상태를 알 수 없음

-----
[HOME](./index.md)
